<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>px64 HTML Sanitizer Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-section {
            margin: 2rem 0;
            padding: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
        }

        .safe {
            border-left: 4px solid #28a745;
        }

        .unsafe {
            border-left: 4px solid #dc3545;
        }

        .test-input {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            background: #f8f9fa;
        }

        .result-box {
            background: #fff;
            border: 1px solid #dee2e6;
            padding: 1rem;
            border-radius: 0.25rem;
            min-height: 3rem;
        }
    </style>
</head>

<body>
    <div class="container py-4" id="app">
        <h1>px64 HTML Sanitizer Test</h1>
        <p class="lead">Testing XSS protection with safe vs unsafe HTML binding.</p>

        <div class="test-section unsafe">
            <h3>üö® UNSAFE: html: binder (Raw HTML)</h3>
            <p><strong>Warning:</strong> This binder allows any HTML, including scripts!</p>
            <textarea class="form-control test-input mb-3" data-bind="value:unsafeHTML" rows="3"
                placeholder="Enter HTML (including malicious code)"></textarea>
            <div class="result-box" data-bind="html:unsafeHTML"></div>
        </div>

        <div class="test-section safe">
            <h3>‚úÖ SAFE: html-safe: binder (Sanitized HTML)</h3>
            <p><strong>Protection:</strong> This binder sanitizes HTML, removing dangerous elements and attributes.</p>
            <textarea class="form-control test-input mb-3" data-bind="value:safeHTML" rows="3"
                placeholder="Enter HTML (will be sanitized)"></textarea>
            <div class="result-box" data-bind="html-safe:safeHTML"></div>
        </div>

        <div class="test-section">
            <h3>üß™ Manual Sanitizer API</h3>
            <p>Test the <code>px64.sanitizeHTML()</code> function directly:</p>
            <textarea class="form-control test-input mb-3" data-bind="value:manualHTML" rows="3"
                placeholder="Enter HTML to sanitize manually"></textarea>
            <div class="result-box" data-bind="text:sanitizedResult"></div>
        </div>

        <div class="test-section">
            <h3>üéØ Test Cases</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>Malicious Examples:</h5>
                    <button class="btn btn-outline-danger btn-sm mb-2" data-bind="tap:loadScript">Load Script
                        Attack</button><br>
                    <button class="btn btn-outline-danger btn-sm mb-2" data-bind="tap:loadOnload">Load Onload
                        Attack</button><br>
                    <button class="btn btn-outline-danger btn-sm mb-2" data-bind="tap:loadIframe">Load Iframe
                        Attack</button><br>
                </div>
                <div class="col-md-6">
                    <h5>Safe Examples:</h5>
                    <button class="btn btn-outline-success btn-sm mb-2" data-bind="tap:loadSafeHTML">Load Safe
                        HTML</button><br>
                    <button class="btn btn-outline-success btn-sm mb-2" data-bind="tap:loadRichText">Load Rich
                        Text</button><br>
                    <button class="btn btn-outline-success btn-sm mb-2" data-bind="tap:loadTable">Load
                        Table</button><br>
                </div>
            </div>
        </div>

        <div class="alert alert-info">
            <h5>üõ°Ô∏è Security Features:</h5>
            <ul class="mb-0">
                <li><strong>Allowed Tags:</strong> p, div, span, h1-h6, strong, em, ul, ol, li, a, img, table, etc.</li>
                <li><strong>Allowed Attributes:</strong> href, src, alt, title, class, id, target, rel</li>
                <li><strong>URL Validation:</strong> Only https://, http://, mailto:, #, and / URLs allowed</li>
                <li><strong>Script Removal:</strong> All &lt;script&gt; tags and event handlers removed</li>
            </ul>
        </div>
    </div>

    <script src="px64.js"></script>
    <script>
        const testState = px64.observable({
            unsafeHTML: '<p>Safe content</p>',
            safeHTML: '<p>Safe content</p>',
            manualHTML: '<strong>Bold text</strong>',
            sanitizedResult: '',

            loadScript() {
                const malicious = '<script>alert("XSS Attack!");</script><p>This should be safe</p>';
                this.$set('unsafeHTML', malicious);
                this.$set('safeHTML', malicious);
            },

            loadOnload() {
                const malicious = '<img src="invalid" onerror="alert(\'XSS via onerror!\')" /><p>Image with malicious handler</p>';
                this.$set('unsafeHTML', malicious);
                this.$set('safeHTML', malicious);
            },

            loadIframe() {
                const malicious = '<iframe src="javascript:alert(\'XSS via iframe!\')"></iframe><p>Iframe attack</p>';
                this.$set('unsafeHTML', malicious);
                this.$set('safeHTML', malicious);
            },

            loadSafeHTML() {
                const safe = '<h4>Welcome!</h4><p>This is <strong>safe</strong> <em>formatted</em> text with a <a href="https://example.com">link</a>.</p>';
                this.$set('unsafeHTML', safe);
                this.$set('safeHTML', safe);
            },

            loadRichText() {
                const rich = '<div><h3>Rich Text Example</h3><p>This content includes:</p><ul><li><strong>Bold text</strong></li><li><em>Italic text</em></li><li><code>Code snippets</code></li><li><a href="https://github.com">External links</a></li></ul><blockquote>A safe blockquote with <mark>highlighted</mark> text.</blockquote></div>';
                this.$set('unsafeHTML', rich);
                this.$set('safeHTML', rich);
            },

            loadTable() {
                const table = '<table class="table table-striped"><thead><tr><th>Name</th><th>Role</th><th>Status</th></tr></thead><tbody><tr><td>John Doe</td><td>Developer</td><td><span class="badge bg-success">Active</span></td></tr><tr><td>Jane Smith</td><td>Designer</td><td><span class="badge bg-warning">Pending</span></td></tr></tbody></table>';
                this.$set('unsafeHTML', table);
                this.$set('safeHTML', table);
            }
        });

        testState.$observe('manualHTML', (value) => {
            const sanitized = px64.sanitizeHTML(value);
            testState.$set('sanitizedResult', sanitized);
        });

        const app = px64.bind('#app', testState);
        app.sanitizedResult = px64.sanitizeHTML(app.manualHTML);
    </script>
</body>

</html>
